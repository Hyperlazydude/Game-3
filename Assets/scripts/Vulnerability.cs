using System.Collections;
using UnityEngine;

public class Vulnerability : MonoBehaviour {
	
    public float flashFrequency;
	public int stunDuration;
    
    [HideInInspector]
    private bool isVulnerable;
    public bool IsVulnerable
    {
        get { return this.isVulnerable; }
    }

    private PlayerManager playerManager;
    private Renderer playerRenderer;

    private void Awake () {
		this.isVulnerable = true;

        this.playerManager = this.GetComponent<PlayerManager>();
        this.playerRenderer = this.GetComponent<Renderer>();
	}

	private void MakeVulnerable () {

        this.playerManager.movementEnabled = true;
        this.playerManager.abilityEnabled = true;
        
		this.isVulnerable = true;
	}

	public void MakeInvulnerable () {

        this.playerManager.movementEnabled = false;
        this.playerManager.abilityEnabled = false;
        
        this.isVulnerable = false;

        this.StartCoroutine(this.Flash());
	}

    private IEnumerator Flash()
    {
        for (int i = this.stunDuration; i >= 0; i--)
        {
            this.playerRenderer.enabled = false;
            yield return new WaitForSeconds(flashFrequency / 2);
            this.playerRenderer.enabled = true;
            yield return new WaitForSeconds(flashFrequency / 2);
        }

        this.MakeVulnerable();
    }
    
}